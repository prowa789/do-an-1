<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title> Giỏ hàng </title>
    <link href="./css/bootstrap.min.css" rel="stylesheet">

    <link href="./css/style.css" rel="stylesheet">

    <link href="https://fonts.googleapis.com/css?family=Roboto+Condensed:300,300i,400,400i,700,700i" rel="stylesheet">

    <link href="./css/owl.carousel.css" rel="stylesheet">
    <link href="./css/owl.theme.default.css" rel="stylesheet">

    <link href="./css/font-awesome.min.css" rel="stylesheet">
    <link rel="shortcut icon" href="/images/favicon.ico">


</head>

<body>
    <div class="loading-spinner"></div>

    <%- include('header'); -%>
    <div class="container">
        <h1 style="padding-top: 3rem;text-align: center;font-family: sans-serif;">Giỏ hàng</h1>
        <% if(cart){ %>
        <table id="cart" class="table table-hover table-condensed">
            <thead>
                <tr>
                    <th class="col1">Tên sản phẩm</th>
                    <th class="col2">Giá</th>
                    <th class="col3">Số lượng</th>
                    <th class="col4">Thao tác</th>
                </tr>
            </thead>
            <% if(locals.errors){ %>
            <p style="text-align: center;font-size: 30px;color:red;" id="errors"><%= locals.errors[0] %></p>
            <% } %>
            <tbody>
                <% for(var i = 0;i < cart.san_pham.length;i++){ %>
                <tr id="<%= cart.san_pham[i].phone_id %>">
                    <td data-th="Product">
                        <div class="row">
                            <div class="col-sm-2 hidden-xs"><img src="<%= cart.san_pham[i].hinh_anh %>" alt="Sản phẩm 1"
                                    class="img-responsive" width="100px">
                            </div>
                            <div class="col-sm-10">
                                <h4 class="nomargin ten-san-pham"><%= cart.san_pham[i].name %></h4>
                            </div>
                        </div>
                    </td>
                    <td data-th="Price"><%= cart.san_pham[i].gia_hien_thi %></td>
                    <td data-th="Quantity">
                        <div class="choosenumber">
                            <input type="hidden" class="phone_id" name="phone_id" value="<%= cart.san_pham[i].phone_id %>">
                            <input type="hidden" class="so_luong" name="so_luong" value="<%= cart.san_pham[i].so_luong %>">
                            <!-- <a href="/giohang/substract/<%= cart.san_pham[i].phone_id%>">
                                    <div class="abate"></div>
                                </a>
                                <div class="number"><%= cart.san_pham[i].so_luong %></div>
                                <a href="/giohang/add/<%= cart.san_pham[i].phone_id%>">
                                    <div class="augment"></div>
                                </a> -->
                            <div class="abate"></div>
                            <div class="number"><%= cart.san_pham[i].so_luong %></div>
                            <div class="augment"></div>

                        </div>
                    </td>
                    <td>
                        <a href="/giohang/remove/<%= cart.san_pham[i].phone_id %>" class="btn trash">
                            <i class="fa fa-trash-o"></i>
                        </a>
                        </button>
                    </td>
                </tr>
                <% } %>

            </tbody>


        </table>
        <div class="container">
            <div class="row">
                <div class="col-sm-5 col-xs-12">
                    <a href="/dienthoai" class="btn btn-block btn-warning" style="padding:15px;font-size: 13px;"><i
                            class="fa fa-angle-left"></i> Tiếp tục mua hàng</a>
                </div>
                <div class="col-sm-4 col-sm-offset-3 col-xs-12 text-center" style="padding: 15px 0 15px 0;">
                    <input type="hidden" class="tong_tien" value="<%=cart.tong_tien%>">
                    <strong style="font-size: 18px;" class="tong_tien_text">Tổng tiền :<%=tong_tien%>đ</strong>
                </div>
            </div>
        </div>
    </div>
    <% } %>
    <!-- thông tin người mua -->
    <form action="" method="POST">
        <div class="container bg-default" style="background-color: #F8F9FA;color: black;">

            <h4 class="my-4">
                Thông tin khách hàng
            </h4>
            <form>
                <div class="form-row">
                    <div class="col-md-6 form-group">
                        <label for="firstname">Họ và tên</label>
                        <input type="text" class="form-control" id="firstname" name="ho_ten" placeholder="Họ và tên"
                            required>
                        <div class="invalid-feedback">
                            Please enter your shipping name.
                        </div>
                    </div>
                </div>

                <div class="form-group col-md-6">
                    <label for="email">Email</label>
                    <input type="email" class="form-control" id="email" name="email" placeholder="you@example.com"
                        required>
                    <div class="invalid-feedback">
                        Please enter your email.
                    </div>
                </div>

                <div class="form-group col-md-6">
                    <label for="adress">Địa chỉ nhận hàng</label>
                    <input type="text" class="form-control" id="adress" name="dia_chi_nhan_hang"
                        placeholder="Hai Bà Trưng,Hà Nội" required>
                    <div class="invalid-feedback">
                        Please enter your shipping address.
                    </div>
                </div>
                <div class="form-group col-md-6">
                    <label for="sdt">SĐT</label>
                    <input type="text" class="form-control" id="sdt" name="sdt" placeholder="0825050178" required>
                    <div class="invalid-feedback">
                        Please enter your phone.
                    </div>
                </div>
                <button class="btn btn-primary bt-lg btn-block" style="height:50px;background-color: rgb(32, 32, 121);"
                    type="submit">Đặt hàng</button>
            </form>
        </div>
    </form>

    <%- include('footer'); -%>
    <script src="./js/jquery.min.js" type="text/javascript"></script>
    <script src="./js/bootstrap.min.js" type="text/javascript"></script>
    <script src="./js/menumaker.js" type="text/javascript"></script>
    <script type="text/javascript" src="./js/jquery.sticky.js"></script>
    <script type="text/javascript" src="./js/sticky-header.js"></script>
    <script type="text/javascript" src="./js/owl.carousel.min.js"></script>
    <script type="text/javascript" src="./js/multiple-carousel.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    <script>
    //    $(document).ready(function(){
    //     $(document).ajaxStart(function() {
    //     $(".loading-spinner").fadeIn(500);
    //     });
    //     $(document).ajaxStop(function() {
    //     $(".loading-spinner").fadeOut(50);
    //     });
    //     });

        document.getElementById("search-input").addEventListener("input", function () {
            let val = document.getElementById("search-input").value;
            setTimeout(function () {

            }, 500)
        });
        $(document).ready(function(){
            $('.augment').click(function () {
            var phone_id = $(this).siblings('.phone_id').val();
            console.log(phone_id);
            $.ajax({
                url: '/api/giohang/add/' + phone_id,
                type: 'GET',
            }).done(function (cart) {
                console.log(cart);
                $('.tong_tien_text').text("Tổng tiền :" + convertMoney(cart.tong_tien) + "đ");
                for(var i =0; i < cart.san_pham.length;i++){
                    if(cart.san_pham[i].phone_id == phone_id){
                        $("input[value='"+ phone_id+"']").siblings('.number').text(cart.san_pham[i].so_luong);
                    }
                    
                }
            });
        });
        $('.abate').click(function () {
           
            var phone_id = $(this).siblings('.phone_id').val();
            console.log(phone_id);
            $.ajax({
                url: '/api/giohang/substract/' + phone_id,
                type: 'GET',
            }).done(function (cart) {
                console.log(cart);
                $('.tong_tien_text').text("Tổng tiền :" + convertMoney(cart.tong_tien) + "đ");
                for(var i = 0; i < cart.san_pham.length;i++){

                    if(cart.san_pham[i].phone_id == phone_id){
                        $("input[value='"+ phone_id+"']").siblings('.number').text(cart.san_pham[i].so_luong);
                        return;
                    }
                }
                $('tr#'+phone_id).remove();
                if(cart.tong_san_pham == 0){
                    $('#errors').text("Không có sản phẩm nào trong giỏ hàng");
                }
        
            });
        }); 
        })
       
        
        function convertMoney(money) {
            var string = "";
            var chuoi_ban_dau = money.toString();
            var len = money.toString().length;
            var k = len % 3;
            if (k == 0) { len = len / 3 } else { len = len / 3 - 1 };
            var temp = chuoi_ban_dau.slice(0, k);
            string += temp;
            for (var i = 0; i < len; i++) {
                if (k != 0) { string += "."; }
                temp = chuoi_ban_dau.slice(k, k + 3);
                string += temp;
                k += 3;
            }
            return string;
        }

    </script>
</body>

</html>